---
export interface Props {
  userPart: string;
  domainPart: string;
  buttonText: string;
  class?: string;
}

const { userPart, domainPart, buttonText, class: className } = Astro.props;
---

<button
  class:list={[
    "font-mono text-sm transition-colors duration-200 ease-in-out group cursor-pointer",
    "text-[var(--color-neutral-content)] hover:text-[var(--color-primary)]",
    "focus:outline-none",
    className
  ]}
  data-user-part={userPart}
  data-domain-part={domainPart}
  data-initial-text={buttonText}
  aria-label="Copy contact email to clipboard"
  type="button"
>
  <span class="main-text font-mono">{buttonText}</span>
  <span class="confirmation-text" style="display: none;"></span>
  <i class="ri-file-copy-line ml-1.5 text-xs opacity-70 group-hover:opacity-100 transition-opacity"></i>
</button>

<script>
  document.querySelectorAll('[data-user-part][data-domain-part]').forEach(button => {
    const mainTextSpan = button.querySelector('.main-text') as HTMLElement | null;
    const confirmationTextSpan = button.querySelector('.confirmation-text') as HTMLElement | null;
    const icon = button.querySelector('i') as HTMLElement | null;
    const initialButtonText = button.getAttribute('data-initial-text');

    if (!mainTextSpan || !confirmationTextSpan || !initialButtonText) return;

    button.addEventListener('click', async () => {
      const user = button.getAttribute('data-user-part');
      const domain = button.getAttribute('data-domain-part');

      if (!user || !domain) return;

      const emailToCopy = `${user}@${domain}`;

      try {
        await navigator.clipboard.writeText(emailToCopy);

        mainTextSpan.style.display = 'none';
        if (icon) icon.style.display = 'none';
        confirmationTextSpan.textContent = 'Copied!';
        confirmationTextSpan.style.display = 'inline';

        setTimeout(() => {
          mainTextSpan.textContent = initialButtonText;
          mainTextSpan.style.display = 'inline';
          if (icon) icon.style.display = 'inline';
          confirmationTextSpan.style.display = 'none';
        }, 2000);
      } catch (err) {
        console.error('Failed to copy email: ', err);
        mainTextSpan.style.display = 'none';
        if (icon) icon.style.display = 'none';
        confirmationTextSpan.textContent = 'Failed';
        confirmationTextSpan.style.display = 'inline';
        setTimeout(() => {
            mainTextSpan.textContent = initialButtonText;
            mainTextSpan.style.display = 'inline';
            if (icon) icon.style.display = 'inline';
            confirmationTextSpan.style.display = 'none';
        }, 2000);
      }
    });
  });
</script>
